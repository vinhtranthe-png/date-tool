<!--
Created using JS Bin
http://jsbin.com

Copyright (c) 2025 by vinhtranthe-png (http://jsbin.com/jiruris/2/edit)

Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<style id="jsbin-css">
body {
  font-family: Arial, sans-serif;
  background: #f4f7f9;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;
  min-height: 100vh;
  box-sizing: border-box;
}

.container {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 500px;
  box-sizing: border-box;
}

h2 {
  text-align: center;
  margin-bottom: 5px;
  font-size: 1.5em;
}

.note {
  font-size: 12px;
  color: #d9534f;
  text-align: center;
  margin-bottom: 15px;
}

label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
}

input, select, button {
  width: 100%;
  padding: 15px;
  margin-top: 5px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

button {
  margin-top: 15px;
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
}

button:hover {
  background: #0056b3;
}

#result {
  margin-top: 20px;
  padding: 12px;
  background: #f1f1f1;
  border-radius: 6px;
  white-space: pre-line;
  font-family: monospace;
}

/* Responsive */
@media screen and (max-width: 500px) {
  .container {
    padding: 15px;
  }
  h2 {
    font-size: 1.3em;
  }
}

</style>
<div class="container">
  <h2>TOOL T√çNH DATE VH3</h2>
   <h2>H·∫ø l√¥ m·∫•y c∆∞ng ƒë·ªçc k·ªπ ƒë·ªÉ d√πng ƒë√∫ng nhen</h2>
  <div class="note">(KH√îNG √ÅP D·ª§NG NH√ìM TH·ªäT, TH·ª¶Y H·∫¢I S·∫¢N)</div>
  <div class="note">Ch·ªâ √°p d·ª•ng t·ª´ nh√≥m 3 (h·∫°n s·ª≠ d·ª•ng t·ª´ 5 ng√†y tr·ªü l√™n)</div>
  
  <label>Ch·ªçn ch·∫ø ƒë·ªô nh·∫≠p li·ªáu:</label>
  <select id="mode" onchange="toggleMode()">
    <option value="1">Ng√†y s·∫£n xu·∫•t + HSD</option>
    <option value="2">Ng√†y h·∫øt h·∫°n + HSD</option>
    <option value="3">Ng√†y s·∫£n xu·∫•t + Ng√†y h·∫øt h·∫°n</option>
  </select>

  <div id="mode1">
    <label>Ng√†y s·∫£n xu·∫•t:</label>
    <input type="date" id="nsx">
    <label>H·∫°n s·ª≠ d·ª•ng (ch·ªâ nh·∫≠p ng√†y):</label>
    <input type="text" id="hsd1" placeholder="Nh·∫≠p s·ªë ng√†y/th√°ng/nƒÉm">
  </div>

  <div id="mode2" style="display:none;">
    <label>Ng√†y h·∫øt h·∫°n:</label>
    <input type="date" id="nhh">
    <label>H·∫°n s·ª≠ d·ª•ng (ch·ªâ nh·∫≠p ng√†y):</label>
    <input type="text" id="hsd2" placeholder="Nh·∫≠p s·ªë ng√†y/th√°ng/nƒÉm">
  </div>

  <div id="mode3" style="display:none;">
    <label>Ng√†y s·∫£n xu·∫•t:</label>
    <input type="date" id="nsx3">
    <label>Ng√†y h·∫øt h·∫°n:</label>
    <input type="date" id="nhh3">
  </div>

  <button onclick="tinhNgay()">T√≠nh to√°n</button>
  <button onclick="copyResult()">Copy k·∫øt qu·∫£</button>

  <div id="result"></div>
</div>

<script id="jsbin-javascript">
window.onload = function() {
  const tableRules = [
    {min:5, max:7, d25:-1, d49:0},
    {min:8, max:29, d25:-2, d49:-1},
    {min:30, max:59, d25:-3, d49:-2},
    {min:60, max:179, d25:-6, d49:-3},
    {min:180, max:364, d25:-20, d49:-15},
    {min:365, max:729, d25:-30, d49:-20},
    {min:730, max:1095, d25:-60, d49:-40}
  ];

  function toggleMode() {
    const mode = document.getElementById("mode").value;
    document.getElementById("mode1").style.display = (mode==="1") ? "block" : "none";
    document.getElementById("mode2").style.display = (mode==="2") ? "block" : "none";
    document.getElementById("mode3").style.display = (mode==="3") ? "block" : "none";

    document.querySelectorAll("input").forEach(input => input.value='');
    document.getElementById("result").innerText = '';
  }

  function parseHSD(value) {
    const match = value.trim().toLowerCase().match(/^(\d+)\s*([dmy]?)$/);
    if(!match) return null;
    return { num: parseInt(match[1]), unit: match[2] || 'd' };
  }

  function addDate(base, num, unit) {
    const date = new Date(base);
    if(unit==='d') date.setDate(date.getDate() + num);
    else if(unit==='m') date.setMonth(date.getMonth() + num);
    else if(unit==='y') date.setFullYear(date.getFullYear() + num);
    return date;
  }

  function formatDate(date){
    const d = date.getDate().toString().padStart(2,'0');
    const m = (date.getMonth()+1).toString().padStart(2,'0');
    const y = date.getFullYear();
    return `${d}/${m}/${y}`;
  }

  window.tinhNgay = function() {
    const mode = document.getElementById('mode').value;
    let nsx, nhh, hsdRaw, ngayHetHan, totalDays;

    if(mode==='1'){
      nsx = document.getElementById('nsx').value;
      hsdRaw = document.getElementById('hsd1').value;
      if(!nsx || !hsdRaw){ alert('nh·∫≠p thi·∫øu th√¥ng tin g√≤i m·∫π'); return; }

      const parsed = parseHSD(hsdRaw);
      if(!parsed){ alert("Sai ƒë·ªãnh d·∫°ng HSD"); return; }

      ngayHetHan = addDate(new Date(nsx), parsed.num - 1, parsed.unit);
      totalDays = parsed.unit==='d'?parsed.num: parsed.unit==='m'?parsed.num*30:parsed.num*365;

    } else if(mode==='2'){
      nhh = document.getElementById('nhh').value;
      hsdRaw = document.getElementById('hsd2').value;
      if(!nhh || !hsdRaw){ alert('Cnh·∫≠p thi·∫øu th√¥ng tin g√≤i m·∫π'); return; }

      const parsed = parseHSD(hsdRaw);
      if(!parsed){ alert("Sai ƒë·ªãnh d·∫°ng HSD"); return; }

      ngayHetHan = new Date(nhh);
      totalDays = parsed.unit==='d'?parsed.num: parsed.unit==='m'?parsed.num*30:parsed.num*365;

    } else if(mode==='3'){
      nsx = document.getElementById('nsx3').value;
      nhh = document.getElementById('nhh3').value;
      if(!nsx || !nhh){ alert('nh·∫≠p thi·∫øu th√¥ng tin g√≤i m·∫π'); return; }

      const nsxDate = new Date(nsx);
      const nhhDate = new Date(nhh);
      ngayHetHan = nhhDate;

      // t√≠nh HSD theo s·ªë ng√†y th·ª±c
      const diffTime = nhhDate - nsxDate;
      totalDays = Math.floor(diffTime / (1000*60*60*24)) + 1; // +1 v√¨ NSX t√≠nh l√† ng√†y ƒë·∫ßu ti√™n
    }

    const today = new Date();
    today.setHours(0,0,0,0);

    // ch·ªâ b√°o h·∫øt h·∫°n v√†o ng√†y h√¥m sau
    const ngayHetHanCheck = new Date(ngayHetHan);
    ngayHetHanCheck.setDate(ngayHetHanCheck.getDate() + 1);

    if(ngayHetHanCheck <= today){
      document.getElementById('result').innerText = "‚ö†Ô∏èh·∫øt date r·ªìi n√≠ ∆°i.‚ö†Ô∏è";
      return;
    }

    const rule = tableRules.find(r=>totalDays >= r.min && totalDays <= r.max);
    if(!rule){ document.getElementById('result').innerText="ƒê√£ n√≥i l√† ch·ªâ √°p d·ª•ng cho nh√≥m 3 m√† m·∫π \n m·∫•y nh√≥m 1 & 2 t·ª± t√≠nh nh·∫©m ƒëi \n ai g·∫£nh ƒë√¢u t√≠nh d√πm"; return; }

    const d25 = addDate(ngayHetHan, rule.d25, 'd');
    const d49 = addDate(ngayHetHan, rule.d49, 'd');

    document.getElementById('result').innerText =
      `üìÖ Ng√†y h·∫øt h·∫°n: ${formatDate(ngayHetHan)}\n`+
      `üîπ Gi·∫£m gi√° 25%: ${formatDate(d25)}\n`+
      `üî∏ Gi·∫£m gi√° 49%: ${formatDate(d49)}\n`+
    `S·ªë l∆∞·ª£ng:`;
  }

window.copyResult = function() {
  const text = document.getElementById('result').innerText.trim();
  if(!text){ alert("‚ö†Ô∏è Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ copy!"); return; }

  // T·∫°o textarea t·∫°m
  const temp = document.createElement("textarea");
  temp.value = text;
  document.body.appendChild(temp);
  temp.select();
  temp.setSelectionRange(0, 99999); // cho mobile
  document.execCommand("copy");
  document.body.removeChild(temp);

  alert("‚úÖ ƒê√£ copy k·∫øt qu·∫£");
  };

  window.toggleMode = toggleMode;
};

</script>